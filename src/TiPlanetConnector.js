
import profile from './pages/omega-ide/src/img/profile.png'

/**
 * Local storage connector class. Dummy connector for dev.
 *
 * @author Maxime "M4x1m3" FRIESS
 * @license MIT
 */
export default class TiPlanetConnector {
    static __instance = null;
    static __allowed_chars_file = "abcdefghijklmnopqrstuvwxyz1234567890_";
    static __init_file_content = "from math import *\n";
    
    static __init_projects = decodeURIComponent(escape(window.atob("eyJMYWJ5IjpbeyJuYW1lIjoicG9seWNhbGMucHkiLCJjb250ZW50IjoiZGVmIGNvbDNfMl9yZ2IoYywgYml0cywgYmdyKTpcbiAgcmV0dXJuIGNbMipiZ3JdLy8yKiooOCAtIGJpdHNbMF0pICsgY1sxXS8vMioqKDggLSBiaXRzWzFdKSoyKipiaXRzWzBdICsgY1syKihub3QgYmdyKV0vLzIqKig4LWJpdHNbMl0pKjIqKihiaXRzWzBdICsgYml0c1sxXSlcbmRlZiBrYzE2X2RyYXdfbGluZSh4MSwgeTEsIHgyLCB5MiwgYyk6XG4gIGRyYXdfbGluZShpbnQoeDEpLCBpbnQoeTEpLCBpbnQoeDIpLCBpbnQoeTIpLCBjb2wzXzJfcmdiKGMsIFs1LCA2LCA1XSwgMSkpXG5cbmRlZiBnZXRfaW5mb3MoKTpcbiAgZ2xvYmFsIGtjMTZfZHJhd19saW5lXG4gIGZub3AgPSBsYW1iZGEgOiBOb25lXG4gIHNjcmVlbl93LCBzY3JlZW5faCwgY29sb3JfYml0cywgcG9seV9zZXRfcGl4ZWwsIHBvbHlfZHJhd19saW5lLCBwb2x5X2ZpbGxfcmVjdCwgcG9seV9jbGVhbl9zY3JlZW4sIG5lZWRfY2xlYW4sIG5lZWRfbGluZSwgbmVlZF9yZWN0ID0gMCwgMjIyLCBbNSwgNiwgNV0sIGZub3AsIGZub3AsIGZub3AsIGZub3AsIDAsIDEsIDFcbiAgdHJ5OlxuICAgIGlmIGNocigyNTYpPT1jaHIoMCk6ICMgS2hpQ0FTIFB5dGhvbiBjb21wYXQuXG4gICAgICBuZWVkX2xpbmUgPSAwXG4gICAgICBuZWVkX2NsZWFuID0gMVxuICAgICAgc2NyZWVuX3cgPSAzMjBcbiAgICAgIGRlZiBwb2x5X3NldF9waXhlbCh4LCB5LCBjKTpcbiAgICAgICAgc2V0X3BpeGVsKHgsIHksIGNvbDNfMl9yZ2IoYywgWzUsNiw1XSwgMCkpXG4gICAgICBwb2x5X2RyYXdfbGluZSA9IGtjMTZfZHJhd19saW5lXG4gIGV4Y2VwdDpcbiAgICBwYXNzXG4gIGlmIG5vdCBzY3JlZW5fdzpcbiAgICBrYzE2X2RyYXdfbGluZSA9IE5vbmVcbiAgICB0cnk6ICMgS2hpQ0FTIE1pY3JvcHl0aG9uXG4gICAgICBpbXBvcnQgZ3JhcGhpY1xuICAgICAgZGVmIHBvbHlfZHJhd19saW5lKHgxLCB5MSwgeDIsIHkyLCBjKTpcbiAgICAgICAgZ3JhcGhpYy5kcmF3X2xpbmUoaW50KHgxKSwgaW50KHkxKSwgaW50KHgyKSwgaW50KHkyKSwgY29sM18yX3JnYihjLCBjb2xvcl9iaXRzLCAxKSlcbiAgICAgIGRlZiBwb2x5X2ZpbGxfcmVjdCh4MSwgeTEsIHgyLCB5MiwgYyk6XG4gICAgICAgIGdyYXBoaWMuZHJhd19maWxsZWRfcmVjdGFuZ2xlKGludCh4MSksIGludCh5MSksIGludCh4MiksIGludCh5MiksIGMpXG4gICAgICBzY3JlZW5fdywgcG9seV9zZXRfcGl4ZWwsIG5lZWRfY2xlYW4sIG5lZWRfbGluZSwgbmVlZF9yZWN0ID0gMzIwLCBncmFwaGljLnNldF9waXhlbCwgMSwgMCwgMFxuICAgIGV4Y2VwdDpcbiAgICAgIHBhc3NcbiAgaWYgbm90IHNjcmVlbl93OlxuICAgIHRyeTogIyBOdW1Xb3Jrc1xuICAgICAgaW1wb3J0IGthbmRpbnNreVxuICAgICAgc2NyZWVuX3csIHBvbHlfc2V0X3BpeGVsLCBuZWVkX3JlY3QgPSAzMjAsIGthbmRpbnNreS5zZXRfcGl4ZWwsIDBcbiAgICAgIGRlZiBwb2x5X2ZpbGxfcmVjdCh4LCB5LCB3LCBoLCBjKTpcbiAgICAgICAga2FuZGluc2t5LmZpbGxfcmVjdChpbnQoeCksIGludCh5KSwgaW50KHcpLCBpbnQoaCksIGMpXG4gICAgZXhjZXB0OlxuICAgICAgcGFzc1xuXG4gIGlmIG5lZWRfbGluZTpcbiAgICBkZWYgcG9seV9kcmF3X2xpbmUoeDEsIHkxLCB4MiwgeTIsIGMpOlxuICAgICAgbSwgYTEsIGIxLCBhMiwgYjIgPSAwLCBpbnQoeDEpLCBpbnQoeTEpLCBpbnQoeDIpLCBpbnQoeTIpXG4gICAgICBpZiAoeDIgLSB4MSkgKiogMiA8ICh5MiAtIHkxKSAqKiAyOlxuICAgICAgICBtLCBhMSwgYTIsIGIxLCBiMiA9IDEsIGIxLCBiMiwgYTEsIGEyXG4gICAgICBpZiBtaW4oYTEsIGEyKSAhPSBhMTogYTEsIGIxLCBhMiwgYjIgPSBhMiwgYjIsIGExLCBiMVxuICAgICAgZm9yIGsgaW4gcmFuZ2UoYTIgLSBhMSArIDEpOlxuICAgICAgICBhLCBiID0gYTEgKyBrLCBpbnQoYjEgKyAoYjIgLSBiMSkgKiBrIC8gKChhMiAtIGExKSBvciAxKSlcbiAgICAgICAgcG9seV9zZXRfcGl4ZWwoKGEsIGIpW21dLCAoYiwgYSlbbV0sIGMpXG5cbiAgaWYgbmVlZF9yZWN0OlxuICAgIGRlZiBwb2x5X2ZpbGxfcmVjdCh4LCB5LCB3LCBoLCBjKTpcbiAgICAgIGZvciBrIGluIHJhbmdlKGgpOlxuICAgICAgICBwb2x5X2RyYXdfbGluZSh4LCB5ICsgaywgeCArIHcgLSAxLCB5ICsgaywgYylcblxuICBpZiBuZWVkX2NsZWFuOlxuICAgIGRlZiBwb2x5X2NsZWFuX3NjcmVlbigpOlxuICAgICAgcG9seV9maWxsX3JlY3QoMCwgMCwgc2NyZWVuX3csIHNjcmVlbl9oLCBbMjU1LCAyNTUsIDI1NV0pXG4gIHJldHVybiBzY3JlZW5fdywgc2NyZWVuX2gsIHBvbHlfc2V0X3BpeGVsLCBwb2x5X2RyYXdfbGluZSwgcG9seV9maWxsX3JlY3QsIHBvbHlfY2xlYW5fc2NyZWVuLCBmbm9wXG4ifSx7Im5hbWUiOiJsYWJ5LnB5IiwiY29udGVudCI6IiNjYXNcbmZyb20gbWF0aCBpbXBvcnQgc2luLCBjb3MsIGFzaW4sIHBpXG5mcm9tIHBvbHljYWxjIGltcG9ydCAqXG5cbmRlZiByaShhLGIpOlxuICBnbG9iYWwgc1xuICBzID0gKHMgKiAyMTQwMTMgKyAyNTMxMDExKSAlIDQyOTQ5NjcyOTZcbiAgciA9IChzIC8vIDY1NTM2KSAmIDB4N2ZmZlxuICByZXR1cm4gciAlIChiLWEpICsgYVxuXG5kZWYgbW9uX3NlY3JldCh2LCBiLCBuKTpcbiAgcmV0dXJuIHYgJiB+KGIgKiAyKipuKVxuXG5kZWYgbW9uX3hvcihhLCBiKTpcbiAgcmV0dXJuIGEgKyBiIC0gKGEgJiBiKVxuXG5kZWYgZml4X2FuZ2xlKGEpOlxuICByZXR1cm4gYSAqIDIgKiBhc2luKDEpIC8gcGlcblxuZGVmIHVmbChyKTpcbiAgZ2xvYmFsIHJsXG4gIGksIHMgPSByIC8vIDMsIDEwICogKHIgJSAzKVxuICByZXAgPSBybFtpXS8vMioqcyAmIDEwMjNcbiAgaWYgcmVwICE9IHI6XG4gICAgcmVwID0gdWZsKHJlcClcbiAgICBybFtpXSA9IG1vbl9zZWNyZXQocmxbaV0sIDEwMjMsIHMpXG4gICAgcyA9IHJlcCAqIDIqKnNcbiAgICBybFtpXSA9IG1vbl94b3IocmxbaV0sIHMpXG4gIHJldHVybiByZXBcblxuZGVmIHVmbShyMSwgcjIpOlxuICBnbG9iYWwgcmxcbiAgaSwgcjEgPSByMSAvLyAzLCAxMCAqIChyMSAlIDMpXG4gIHIyICo9IDIqKnIxXG4gIHJsW2ldID0gbW9uX3NlY3JldChybFtpXSwgMTAyMywgcjEpXG4gIHJsW2ldID0gbW9uX3hvcihybFtpXSwgcjIpXG5cbmRlZiBjb3V0KHgpOlxuICByZXR1cm4gbGVuKHN0cihyb3VuZChhYnMoeCkvMS4sNSkpKVxuXG5kZWYgYV9nYXVjaGUoYSk6XG4gIGdsb2JhbCBzdGF0ZVxuICBzdGF0ZVs3XSArPSBhXG4gIHN0YXRlWzVdICs9IDUgKyBjb3V0KGEpXG4gIHN0YXRlWzJdIC09IGFcblxuZGVmIGFfZHJvaXRlKGEpOlxuICBzdGF0ZVs3XSArPSAyICogYVxuICBhX2dhdWNoZSgtYSlcblxuZGVmIGF2YW5jZXIobCk6XG4gIGdsb2JhbCBzdGF0ZVxuICB0ID0gZml4X2FuZ2xlKHN0YXRlWzJdKVxuICBkeCwgZHkgPSBjb3ModCksIHNpbih0KVxuICBzdGF0ZVs3XSArPSBsXG4gIHN0YXRlWzVdICs9IDggKyBjb3V0KGwpXG4gIHdoaWxlKGwgPiAwKTpcbiAgICBzdGF0ZVszOjVdID0gc3RhdGVbMDoyXVxuICAgIHgsIHkgPSBzdGF0ZVswXSArIGR4LzQsIHN0YXRlWzFdICsgZHkvNFxuICAgIGl4LCBpeSA9IGludCh4KSAtICh4IDwgMCksIGludCh5KSAtICh5IDwgMClcbiAgICBkcngsIGRyeSA9IGl4IC0gaW50KHN0YXRlWzNdKSwgaXkgLSBpbnQoc3RhdGVbNF0pXG4gICAgdncgPSBsYW1iZGEgeSwgeDogd2xbeV0gJiAyKip4XG4gICAgaHcgPSBsYW1iZGEgeSwgeDogd2xbeSArIGxhYnlfaF0gJiAyKip4XG4gICAgd3ggPSBsYWJ5X3cgLSAyIC0gbWluKGl4LCBpeCAtIGRyeClcbiAgICB0eCA9IGRyeCBhbmQgKGl4IDwgMCBvciBpeCA+PSBsYWJ5X3cgb3IgdncoaXkgLSBkcnksIGxhYnlfdyAtIDIgLSBtaW4oaXgsIGl4IC0gZHJ4KSkpXG4gICAgdHkgPSBkcnkgYW5kIChpeSA8IDAgb3IgaXkgPj0gbGFieV9oIG9yIGh3KG1pbihpeSwgaXkgLSBkcnkpLCBsYWJ5X3cgLSAxIC0gKGl4IC0gZHJ4KSkpXG4gICAgdCA9IGR4IDw9IDAgb3IgaW50KHgpIDwgbGFieV93IC0gMSBvciBpbnQoeSkgPCBsYWJ5X2ggLSAxXG4gICAgaWYgdCBhbmQgdHggb3IgdHkgb3IgKGRyeCBhbmQgZHJ5IGFuZCAodCBhbmQgdHggb3IgdHkpKSBvciAoZHJ4IGFuZCBkcnkgYW5kICh0IGFuZCB2dyhpeSwgbGFieV93IC0gMiAtIG1pbihpeCwgaXggLSBkcngpKSBvciBodyhtaW4oaXksIGl5IC0gZHJ5KSwgbGFieV93IC0gMSAtIGl4KSkpOlxuICAgICAgc3RhdGVbNV0gKz0gMTVcbiAgICAgIHJldHVyblxuICAgIGwgLT0gLjI1XG4gICAgc3RhdGVbNl0gKz0gKHN0YXRlWzZdIDwgMjAwKVxuICAgIHN0YXRlWzA6Ml0gPSAoeCwgeSlcbiAgICBwb2x5X2RyYXdfbGluZShzdGF0ZVszXSAqIHp4LCBzdGF0ZVs0XSAqIHp5LCBzdGF0ZVswXSAqIHp4LCBzdGF0ZVsxXSAqIHp5LCBjb2xvcnNbNF0pXG5cbmxhYnlfdywgbGFieV9oID0gMjAsIDEyXG5zID0gMHhkZWFkYmVlZlxuXG5ybCA9IFsoMyppICsgMikqMTA0ODU3NiArICgzKmkgKyAxKSoxMDI0ICsgMyppIGZvciBpIGluIHJhbmdlKChsYWJ5X3cqbGFieV9oICsgMikgLy8gMyldXG53bCA9IFsoMioqKGxhYnlfdyArIDEpIC0gMSkgLy8gKDEgKyAoayA8IGxhYnlfaCkpIGZvciBrIGluIHJhbmdlKDIqbGFieV9oIC0gMSldXG5jbCA9IGxhYnlfdyAqIGxhYnlfaFxud2hpbGUgY2wgPiAxIC0gKGxhYnlfdyAqIGxhYnlfaCkvLzEwMCoxMDpcbiAgeSA9IHJpKDAsIDIqbGFieV9oIC0gMSlcbiAgeCA9IHJpKDAsIGxhYnlfdyAtICh5IDwgbGFieV9oKSlcbiAgaWYgd2xbeV0gJiAyKip4OlxuICAgIGlmIHkgPCBsYWJ5X2g6XG4gICAgICByMSA9IHkqbGFieV93ICsgeFxuICAgICAgcjIgPSByMSArIDFcbiAgICBlbHNlOlxuICAgICAgcjEgPSAoeSAtIGxhYnlfaCkqbGFieV93ICsgeFxuICAgICAgcjIgPSByMSArIGxhYnlfd1xuICAgIHJsMSwgcmwyID0gdWZsKHIxKSwgdWZsKHIyKVxuICAgIGlmIHJsMSAhPSBybDIgb3IgY2wgPD0gMTpcbiAgICAgIHVmbShybDEsIHJsMilcbiAgICAgIGNsIC09IDFcbiAgICAgIHdsW3ldID0gbW9uX3NlY3JldCh3bFt5XSwgMSwgeClcbmZvciByIGluIHJhbmdlKGxhYnlfdyAqIGxhYnlfaCk6XG4gIHVmbChyKVxuXG5zY3JlZW5fdywgc2NyZWVuX2gsIHBvbHlfc2V0X3BpeGVsLCBwb2x5X2RyYXdfbGluZSwgcG9seV9maWxsX3JlY3QsIHBvbHlfY2xlYW5fc2NyZWVuLCBwb2x5X3Nob3dfc2NyZWVuID0gZ2V0X2luZm9zKClcbmRzID0gNFxuemludCA9IDEgKyAoc2NyZWVuX3cgPiAyKmxhYnlfdypkcylcbmRzICs9IHppbnQgLSAxXG56eCwgenkgPSAoc2NyZWVuX3cgLSB6aW50KSAvIGxhYnlfdywgKHNjcmVlbl9oIC0gemludCkgLyBsYWJ5X2hcbmdldF9pbmZvcywgcG9seV9zZXRfcGl4ZWwsIHJsLCB1ZmwsIHVmbSA9IE5vbmUsIE5vbmUsIE5vbmUsIE5vbmUsIE5vbmVcbmNvbG9ycyA9IChbMCwgOTUsIDBdLCBbMCwgMCwgNjNdLCBbMCwgMTI3LCAwXSwgWzAsIDAsIDc5XSwgWzI1NSwgMCwgMF0pXG5cbmRlZiBhbGxlcl9zZWxvbihmKTpcbiAgZ2xvYmFsIHN0YXRlXG4gIHN0YXRlID0gWzAsIC41LCAwLCAwLCAuNSwgMCwgMCwgMF1cbiAgcG9seV9jbGVhbl9zY3JlZW4oKVxuICBmb3IgaSBpbiByYW5nZSgyKTpcbiAgICBwb2x5X2ZpbGxfcmVjdCgwLCBpICogbGFieV9oICogenksIGxhYnlfdyAqIHp4LCB6aW50LCBjb2xvcnNbMV0pXG4gICAgcG9seV9maWxsX3JlY3QoaSAqIGxhYnlfdyAqIHp4LCAobm90IGkpICogenksIHppbnQsIChsYWJ5X2ggLSAxKSAqIHp5LCBjb2xvcnNbMF0pXG4gIGZvciB5IGluIHJhbmdlKDIqbGFieV9oIC0gMSk6XG4gICAgZm9yIHogaW4gcmFuZ2UobGFieV93IC0gKHkgPCBsYWJ5X2gpKTpcbiAgICAgIGlmIHdsW3ldICYgMioqejpcbiAgICAgICAgeCA9IGxhYnlfdyAtIDEgLSB6XG4gICAgICAgIGlmIHkgPCBsYWJ5X2g6XG4gICAgICAgICAgcG9seV9maWxsX3JlY3QoeCAqIHp4LCB5ICogenksIHppbnQsIHp5LCBjb2xvcnNbMl0pXG4gICAgICAgIGVsc2U6XG4gICAgICAgICAgcG9seV9maWxsX3JlY3QoeCAqIHp4LCAoeSAtIGxhYnlfaCArIDEpICogenksIHp4LCB6aW50LCBjb2xvcnNbM10pXG4gIGYoKVxuICBwb2x5X3Nob3dfc2NyZWVuKClcbiAgc3RhdGVbNV0gKz0gc2luKGZpeF9hbmdsZShzdGF0ZVs3XSkpIC0gc3RhdGVbNl0gLy8gMlxuICBwcmludCgnQ29uc29tbWF0aW9uIDogJyArIHN0cihzdGF0ZVs1XSkpXG4gIGlmIHN0YXRlWzBdID49IGxhYnlfdzpcbiAgICBwcmludCgnQnJhdm8sIHR1IGVzIHNvcnRpLWUuJylcbiAgICBwcmludCgnUG91ciBqb3VlciBldCBnYWduZXIsJylcbiAgICBwcmludCgnZW52b2llIHRvbiBzY3JpcHQgYScpXG4gICAgcHJpbnQoJ2luZm9AdGlwbGFuZXQub3JnLicpXG4gIHJldHVybiBzdGF0ZVs1XVxuIn0seyJuYW1lIjoibGFieXRlc3QucHkiLCJjb250ZW50IjoiI2Nhc1xuZnJvbSBsYWJ5IGltcG9ydCAqXG5cbmRlZiBjaGVtaW4oKTpcbiAgYXZhbmNlcigxLjUpXG4gIGFfZHJvaXRlKDEuNTcwNzk2MzI2Nzk0ODk2NilcbiAgYXZhbmNlcigxKVxuIn1dLCJDQVZFIjpbeyJuYW1lIjoiY2F2ZS5weSIsImNvbnRlbnQiOiIjY2FzXG5mcm9tIG1hdGggaW1wb3J0IHBpLCBzaW4sIGNvcywgc3FydFxuZnJvbSBwb2x5Y2FsMiBpbXBvcnQgKlxuXG5kZWYgcm5kKCk6XG4gIGdsb2JhbCBzXG4gIHJuZF9tYXggPSAweDdmZmZcbiAgcyA9IChzICogMjE0MDEzICsgMjUzMTAxMSkgJSA0Mjk0OTY3Mjk2XG4gIHJldHVybiAoKHMgLy8gKDIqcm5kX21heCArIDEpKSAmIHJuZF9tYXgpIC8gcm5kX21heFxuXG5kZWYgaG1hcCh0KTpcbiAgZnJxLCBwaGEsIGhtLCBhbXAgPSBbIDEsIDMsIDE1LCAyMSwgMzksIDUxLCA5NywgMTQ1IF0sIFtdLCBbXSwgW11cbiAgZm9yIGkgaW4gcmFuZ2UoOCk6XG4gICAgYW1wLmFwcGVuZCgocm5kKCkgKyAxKSAqIChjYXZlX2ggKiAyNykgLyAyMDAgLyAxLjIqKmkpXG4gIGZvciBrIGluIGZycTpcbiAgICBwaGEuYXBwZW5kKHBpICogcm5kKCkpXG4gIGZvciB4IGluIHJhbmdlKGNhdmVfdyk6XG4gICAgaG0uYXBwZW5kKGludChzdW0oW2FtcFtpXSAqICgxICsgc2luKGZpeF9hbmdsZShmcnFbaV0qeC9jYXZlX3cgKyBwaGFbaV0pKSkgLyAyIGZvciBpIGluIHJhbmdlKGxlbihhbXApKV0pKSlcbiAgcmV0dXJuIFsgaCAtIG1pbihobSkgKyB0IGZvciBoIGluIGhtIF1cblxuY2F2ZV93LCBjYXZlX2gsIHMgPSAxMjgsIDY0LCAweGRlYWRiZWVmXG5mbCwgY3YgPSBobWFwKDIpLCBobWFwKDgpXG5cbnNjcmVlbl93LCBzY3JlZW5faCwgcG9seV9oYXNfY29sb3IsIHBvbHlfc2V0X3BpeGVsLCBwb2x5X2RyYXdfbGluZSwgcG9seV9maWxsX3JlY3QsIHBvbHlfZmlsbF9lbGxpcHNlLCBwb2x5X2NsZWFuX3NjcmVlbiwgcG9seV9zaG93X3NjcmVlbiA9IGdldF9pbmZvcygpXG56eCwgenkgPSAoc2NyZWVuX3cgLSAxKSAvIChjYXZlX3cgLSAxKSwgKHNjcmVlbl9oIC0gMSkgLyAoY2F2ZV9oIC0gMSlcbmdldF9pbmZvcywgcG9seV9zZXRfcGl4ZWwsIGhtYXAsIHJuZCA9IE5vbmUsIE5vbmUsIE5vbmUsIE5vbmVcblxuZGVmIGludGVycG9sMSh5aSwgeWYsIGR4KTpcbiAgcmV0dXJuIHlpICsgZHgqKHlmIC0geWkpXG5cbmRlZiBpbnRlcnBvbF9saXN0KGxzdCwgaSk6XG4gIGkwID0gaW50KGkpXG4gIHYgPSBsc3RbaTBdXG4gIGlmIGkgPiBpMCBhbmQgaSA8IGxlbihsc3QpIC0gMTpcbiAgICB2ID0gaW50ZXJwb2wxKHYsIGxzdFtpMCArIDFdLCBpIC0gaTApXG4gIHJldHVybiB2XG5cbmRlZiB0ZXN0X2NvbGxpc2lvbih4LCB5KTpcbiAgZiA9IGNhdmVfaCAtIGludGVycG9sX2xpc3QoZmwsIHgpXG4gIHJldHVybiB5ID49IGYgb3IgeSA8PSBmLWludGVycG9sX2xpc3QoY3YsIHgpXG5cbmRlZiB0ZXN0X2NvbGxpc2lvbl9yZWN0KHgsIHksIGR4LCBkeSk6XG4gIHgxLCB4MiwgeTEsIHkyID0gbWF4KDAsIHggLSBkeCksIG1pbihjYXZlX3cgLSAxLCB4ICsgZHgpLCB5IC0gZHksIHkgKyBkeVxuICByZXR1cm4gdGVzdF9jb2xsaXNpb24oeDEsIHkxKSArIHRlc3RfY29sbGlzaW9uKHgyLCB5MSkgKyB0ZXN0X2NvbGxpc2lvbih4MSwgeTIpICsgdGVzdF9jb2xsaXNpb24oeDIsIHkyKVxuXG5kZWYgdGVzdF9iYWxsb29uKHgsIHksIHJ4LCByeSwgZF92ZXJ0KTpcbiAgcm1heCwgcjIsIGssIGNvbGxpc2lvbnMgPSBbcngsIHJ5XVtkX3ZlcnRdLCBbcnksIHJ4XVtkX3ZlcnRdLCAtMSwgMFxuICB3aGlsZSBrIDwgcm1heDpcbiAgICBrID0gbWluKGsgKyAxLCBybWF4KVxuICAgIGsyID0gc3FydChtYXgoMCwgcjIqcjIqKDEgLSBrKmsvcm1heC9ybWF4KSkpXG4gICAgY29sbGlzaW9ucyArPSB0ZXN0X2NvbGxpc2lvbl9yZWN0KHgsIHksIFtrLCBrMl1bZF92ZXJ0XSwgW2syLCBrXVtkX3ZlcnRdKVxuICByZXR1cm4gY29sbGlzaW9uc1xuXG5kZWYgcnh5KGEpOlxuICBpZiBhJTIgPT0gMTpcbiAgICByeCwgcnkgPSAwLCAxLTIqKGElNCA9PSAzKVxuICBlbHNlOlxuICAgIGEgPSBmaXhfYW5nbGUoYSAqIHBpLzIpXG4gICAgcngsIHJ5ID0gYWJzKGNvcyhhKSksIGFicyhzaW4oYSkpXG4gIHJldHVybiAxICsgYWJzKHJ4KSwgMSArIGFicyhyeSlcblxuY29sb3JzID0gKFswLCAwLCAwXSwgWzI1NSwgMjU1LCAyNTVdLCBbMCwgMCwgMjU1XSwgWzI1NSwgMCwgMF0sIFsxNTksIDE1OSwgMTU5XSlcblxuZGVmIG1vZGlmaWVyX3ZvbChheSwgZGEsIGR0KTpcbiAgZ2xvYmFsIHN0YXRlXG4gIGlmIGF5IG9yIGRhOlxuICAgIHN0YXRlWzRdICs9IDEwXG4gIHgsIHksIGEgPSBzdGF0ZVswOjNdXG4gIHdoaWxlIHN0YXRlWzBdIDwgY2F2ZV93IC0gMSBhbmQgZHQ6XG4gICAgc3RhdGVbMF0gKz0gMVxuICAgIHN0YXRlWzJdID0gbWF4KDAsIG1pbigxLCBhICsgZGEpKVxuICAgIHN0YXRlWzNdIC09IGF5XG4gICAgc3RhdGVbMV0gPSBtYXgoMCwgbWluKGNhdmVfaCAtIDEsIHN0YXRlWzFdICsgc3RhdGVbM10pKVxuICAgIGR0ID0gbWF4KDAsIGR0IC0gMSkgIFxuICAgIGRhLCBkYXBpLCBkeCA9IGFicyhzdGF0ZVsyXSAtIGEpLCBhYnMoc3RhdGVbMl0gLSAuNSksIDFcbiAgICBzdGF0ZVs0XSArPSAzKihkYSA+IDApKigxICsgZGEpICsgMiooZGFwaSA+IDApKigxICsgZGFwaSlcbiAgICB4YywgeWMsIGR4ID0geCwgeSwgMVxuICAgIHJ4LCByeSA9IHJ4eShzdGF0ZVsyXSlcbiAgICBpZiBzdGF0ZVsxXSAhPSB5OlxuICAgICAgZHggPSBtaW4oMSAvIGFicyhzdGF0ZVsxXSAtIHkpLCAxKVxuICAgIGNvbGxpc2lvbnMgPSB0ZXN0X2JhbGxvb24oc3RhdGVbMF0sIHN0YXRlWzFdLCByeCwgcnksIDApICsgdGVzdF9iYWxsb29uKHN0YXRlWzBdLCBzdGF0ZVsxXSwgcngsIHJ5LCAxKVxuICAgIGlmIGNvbGxpc2lvbnM6XG4gICAgICBzdGF0ZVs0XSArPSA3ICogKDEgKyBjb2xsaXNpb25zKVxuICAgIHdoaWxlIHhjIDwgc3RhdGVbMF06XG4gICAgICB4YyArPSBkeC96eFxuICAgICAgeWMgPSBpbnRlcnBvbDEoeSwgc3RhdGVbMV0sIHhjIC0geClcbiAgICAgIHJ4LCByeSA9IHJ4eShpbnRlcnBvbDEoYSwgc3RhdGVbMl0sIHN0YXRlWzJdIC0gYSkpXG4gICAgICBwb2x5X2ZpbGxfZWxsaXBzZSh4YyAqIHp4LCB5YyAqIHp5LCByeCAqIHp4LCByeSAqIHp5LCBjb2xvcnNbMipwb2x5X2hhc19jb2xvciArIChjb2xsaXNpb25zID4gMCldKVxuICAgIHgsIHksIGEgPSBzdGF0ZVswXSwgc3RhdGVbMV0sIHN0YXRlWzJdXG5cbmRlZiB2b2xlcl9zZWxvbihmKTpcbiAgZ2xvYmFsIHN0YXRlLCBmbCwgY3ZcbiAgc3RhdGUgPSBbMCwgMTIsIC41LCAwLDBdXG4gIHBvbHlfZmlsbF9yZWN0KDAsIDAsIHNjcmVlbl93LCBzY3JlZW5faCwgY29sb3JzWzRdKVxuICBmb3IgeCBpbiByYW5nZShjYXZlX3cpOlxuICAgIGYxLCBkeCA9IGNhdmVfaCAtIGZsW3hdLCAwXG4gICAgYzEgPSBmMSAtIGN2W3hdXG4gICAgd2hpbGUgZHggPCB6eDpcbiAgICAgIGYyID0gY2F2ZV9oIC0gaW50ZXJwb2xfbGlzdChmbCwgeCArIGR4L3p4KVxuICAgICAgYzIgPSBmMiAtIGludGVycG9sX2xpc3QoY3YsIHggKyBkeC96eClcbiAgICAgIHBvbHlfZHJhd19saW5lKHgqenggKyBkeCwgYzIgKiB6eSwgeCp6eCArIGR4LCBmMiAqIHp5LCBjb2xvcnNbMV0pXG4gICAgICBkeCArPSAxXG4gICAgaWYgcG9seV9oYXNfY29sb3I6XG4gICAgICBwb2x5X2RyYXdfbGluZSh4ICogengsIGMxICogenksICh4ICsgMSkgKiB6eCwgYzIgKiB6eSwgY29sb3JzWzBdKVxuICAgICAgcG9seV9kcmF3X2xpbmUoeCAqIHp4LCBmMSAqIHp5LCAoeCArIDEpICogengsIGYyICogenksIGNvbG9yc1swXSlcbiAgZigpXG4gIGlmIHN0YXRlWzBdIDwgY2F2ZV93IC0gMTpcbiAgICBtb2RpZmllcl92b2woMCwgMCwgY2F2ZV93IC0gMSAtIHN0YXRlWzBdKVxuICBwb2x5X3Nob3dfc2NyZWVuKClcbiAgcHJpbnQoJ0NvbnNvbW1hdGlvbiA6ICcgKyBzdHIoc3RhdGVbNF0pKVxuICBwcmludCgnQnJhdm8sIHR1IGVzIHBhc3NlLWUuJylcbiAgcHJpbnQoJ1BvdXIgam91ZXIgZXQgZ2FnbmVyLCcpXG4gIHByaW50KCdlbnZvaWUgdG9uIHNjcmlwdCBhJylcbiAgcHJpbnQoJ2luZm9AdGlwbGFuZXQub3JnLicpXG4gIHJldHVybiBzdGF0ZVs0XVxuIn0seyJuYW1lIjoiY2F2ZXRlc3QucHkiLCJjb250ZW50IjoiZnJvbSBtYXRoIGltcG9ydCAqXG4jY2FzXG5mcm9tIGNhdmUgaW1wb3J0ICpcblxuZGVmIHBsYW4oKTpcbiAgbW9kaWZpZXJfdm9sKC0xLCAwLCA1KVxuICBtb2RpZmllcl92b2woMSwgMCwgOClcbiAgbW9kaWZpZXJfdm9sKC0wLjg5LCAwLjEsIDYpXG4gIG1vZGlmaWVyX3ZvbCgwLCAwLjEsIDUpXG4gIG1vZGlmaWVyX3ZvbCgxLCAwLjEsIDgpXG5cbnZvbGVyX3NlbG9uKHBsYW4pXG4ifSx7Im5hbWUiOiJwb2x5Y2FsMi5weSIsImNvbnRlbnQiOiJmcm9tIG1hdGggaW1wb3J0ICpcbmZyb20gbWF0aCBpbXBvcnQgcGksIGFzaW4sIHNxcnRcblxuZGVmIGZpeF9hbmdsZShhKTpcbiAgcmV0dXJuIGEgKiAyICogYXNpbigxKSAvIHBpXG5cbmRlZiBjb2wzXzJfcmdiKGMsIGJpdHMsIGJncik6XG4gIHJldHVybiBjWzIqYmdyXS8vMioqKDggLSBiaXRzWzBdKSArIGNbMV0vLzIqKig4IC0gYml0c1sxXSkqMioqYml0c1swXSArIGNbMioobm90IGJncildLy8yKiooOC1iaXRzWzJdKSoyKiooYml0c1swXSArIGJpdHNbMV0pXG5kZWYga2MxNl9kcmF3X2xpbmUoeDEsIHkxLCB4MiwgeTIsIGMpOlxuICBkcmF3X2xpbmUoaW50KHgxKSwgaW50KHkxKSwgaW50KHgyKSwgaW50KHkyKSwgY29sM18yX3JnYihjLCBbNSwgNiwgNV0sIDEpKVxuZGVmIGtjMTZfZmlsbF9yZWN0KHgsIHksIHcsIGgsIGMpOlxuICBkcmF3X3JlY3RhbmdsZShmbG9hdCh4KSwgZmxvYXQoeSksIGZsb2F0KHcpLCBmbG9hdChoKSwgY29sM18yX3JnYihjLCBbNSwgNiwgNV0sIDEpICsgZmlsbGVkKVxuZGVmIGtjMTZfZmlsbF9lbGxpcHNlKHgsIHksIHJ4LCByeSwgYyk6XG4gIGRyYXdfYXJjKGZsb2F0KHgpLCBmbG9hdCh5KSwgZmxvYXQocngpLCBmbG9hdChyeSksIDAsIDIqcGksIGNvbDNfMl9yZ2IoYywgWzUsIDYsIDVdLCAxKSArIGZpbGxlZClcblxuZGVmIGdldF9pbmZvcygpOlxuICBnbG9iYWwga2MxNl9kcmF3X2xpbmUsIGtjMTZfZmlsbF9yZWN0LCBrYzE2X2ZpbGxfZWxsaXBzZVxuICBmbm9wID0gbGFtYmRhIDogTm9uZVxuICBzY3JlZW5fdywgc2NyZWVuX2gsIGNvbG9yX2JpdHMsIHBvbHlfaGFzX2NvbG9yLCBwb2x5X3NldF9waXhlbCwgcG9seV9zaG93LCBwb2x5X2RyYXdfbGluZSwgcG9seV9maWxsX3JlY3QsIHBvbHlfZmlsbF9lbGxpcHNlLCBwb2x5X2NsZWFuX3NjcmVlbiwgcG9seV9wYXVzZSwgbmVlZF9jbGVhbiwgbmVlZF9wYXVzZSwgbmVlZF9saW5lLCBuZWVkX3JlY3QsIG5lZWRfZWxsaXBzZSA9IDAsIDAsIFs1LCA2LCA1XSwgMSwgZm5vcCwgZm5vcCwgZm5vcCwgZm5vcCwgZm5vcCwgZm5vcCwgZm5vcCwgMCwgMCwgMSwgMSwgMVxuICB0cnk6XG4gICAgaWYgY2hyKDI1Nik9PWNocigwKTogIyBLaGlDQVMgUHl0aG9uIGNvbXBhdC5cbiAgICAgIG5lZWRfbGluZSA9IDBcbiAgICAgIG5lZWRfY2xlYW4gPSAxXG4gICAgICBzY3JlZW5fdywgc2NyZWVuX2ggPSAzMjAsIDIyMlxuICAgICAgZGVmIHBvbHlfc2V0X3BpeGVsKHgsIHksIGMpOlxuICAgICAgICBzZXRfcGl4ZWwoeCwgeSwgY29sM18yX3JnYihjLCBbNSw2LDVdLCAwKSlcbiAgICAgIHBvbHlfZHJhd19saW5lLCBwb2x5X2ZpbGxfcmVjdCwgcG9seV9maWxsX2VsbGlwc2UgPSBrYzE2X2RyYXdfbGluZSwga2MxNl9maWxsX3JlY3QsIGtjMTZfZmlsbF9lbGxpcHNlXG4gIGV4Y2VwdDpcbiAgICBwYXNzXG4gIGlmIG5vdCBzY3JlZW5fdzpcbiAgICBrYzE2X2RyYXdfbGluZSwgcG9seV9maWxsX3JlY3QsIHBvbHlfZmlsbF9lbGxpcHNlID0gTm9uZSwgTm9uZSwgTm9uZVxuICAgIHRyeTogIyBLaGlDQVMgTWljcm9weXRob25cbiAgICAgIGltcG9ydCBncmFwaGljXG4gICAgICBkZWYgcG9seV9kcmF3X2xpbmUoeDEsIHkxLCB4MiwgeTIsIGMpOlxuICAgICAgICBncmFwaGljLmRyYXdfbGluZShpbnQoeDEpLCBpbnQoeTEpLCBpbnQoeDIpLCBpbnQoeTIpLCBjb2wzXzJfcmdiKGMsIGNvbG9yX2JpdHMsIDEpKVxuICAgICAgZGVmIHBvbHlfZmlsbF9yZWN0KHgxLCB5MSwgeDIsIHkyLCBjKTpcbiAgICAgICAgZ3JhcGhpYy5kcmF3X2ZpbGxlZF9yZWN0YW5nbGUoaW50KHgxKSwgaW50KHkxKSwgaW50KHgyKSwgaW50KHkyKSwgYylcbiAgICAgIGRlZiBwb2x5X2ZpbGxfZWxsaXBzZSh4LCB5LCByeCwgcnksIGMpOlxuICAgICAgICBncmFwaGljLmRyYXdfZmlsbGVkX2FyYyhpbnQoeCksIGludCh5KSwgaW50KHJ4KSwgaW50KHJ5KSwgMCwgMzYwLCBjKVxuICAgICAgc2NyZWVuX3csIHNjcmVlbl9oLCBwb2x5X3NldF9waXhlbCwgbmVlZF9jbGVhbiwgbmVlZF9saW5lLCBuZWVkX3JlY3QsIG5lZWRfZWxsaXBzZSA9IDMyMCwgMjIyLCBncmFwaGljLnNldF9waXhlbCwgMSwgMCwgMCwgMFxuICAgIGV4Y2VwdDpcbiAgICAgIHBhc3NcbiAgaWYgbm90IHNjcmVlbl93OlxuICAgIHRyeTogIyBOdW1Xb3Jrc1xuICAgICAgaW1wb3J0IGthbmRpbnNreVxuICAgICAgc2NyZWVuX3csIHNjcmVlbl9oLCBwb2x5X3NldF9waXhlbCwgbmVlZF9yZWN0ID0gMzIwLCAyMjIsIGthbmRpbnNreS5zZXRfcGl4ZWwsIDBcbiAgICAgIGRlZiBwb2x5X2ZpbGxfcmVjdCh4LCB5LCB3LCBoLCBjKTpcbiAgICAgICAga2FuZGluc2t5LmZpbGxfcmVjdChpbnQoeCksIGludCh5KSwgaW50KHcpLCBpbnQoaCksIGMpXG4gICAgZXhjZXB0OlxuICAgICAgcGFzc1xuICBpZiBuZWVkX2xpbmU6XG4gICAgZGVmIHBvbHlfZHJhd19saW5lKHgxLCB5MSwgeDIsIHkyLCBjKTpcbiAgICAgIG0sIGExLCBiMSwgYTIsIGIyID0gMCwgaW50KHgxKSwgaW50KHkxKSwgaW50KHgyKSwgaW50KHkyKVxuICAgICAgaWYgKHgyIC0geDEpICoqIDIgPCAoeTIgLSB5MSkgKiogMjpcbiAgICAgICAgbSwgYTEsIGEyLCBiMSwgYjIgPSAxLCBiMSwgYjIsIGExLCBhMlxuICAgICAgaWYgbWluKGExLCBhMikgIT0gYTE6IGExLCBiMSwgYTIsIGIyID0gYTIsIGIyLCBhMSwgYjFcbiAgICAgIGZvciBrIGluIHJhbmdlKGEyIC0gYTEgKyAxKTpcbiAgICAgICAgYSwgYiA9IGExICsgaywgaW50KGIxICsgKGIyIC0gYjEpICogayAvICgoYTIgLSBhMSkgb3IgMSkpXG4gICAgICAgIHBvbHlfc2V0X3BpeGVsKChhLCBiKVttXSwgKGIsIGEpW21dLCBjKVxuXG4gIGlmIG5lZWRfcmVjdDpcbiAgICBkZWYgcG9seV9maWxsX3JlY3QoeCwgeSwgdywgaCwgYyk6XG4gICAgICBmb3IgayBpbiByYW5nZShoKTpcbiAgICAgICAgcG9seV9kcmF3X2xpbmUoeCwgeSArIGssIHggKyB3IC0gMSwgeSArIGssIGMpXG5cbiAgaWYgbmVlZF9lbGxpcHNlOlxuICAgIGZyb20gbWF0aCBpbXBvcnQgc3FydFxuICAgIGRlZiBwb2x5X2ZpbGxfZWxsaXBzZSh4LCB5LCByeCwgcnksIGMpOlxuICAgICAgZm9yIGggaW4gcmFuZ2UoLXJ5LCByeSsxKTpcbiAgICAgICAgdyA9IHNxcnQobWF4KDAsIHJ4KnJ4KigxLWgqaC9yeS9yeSkpKVxuICAgICAgICB4MSwgeDIgPSB4IC0gdywgeCArIHdcbiAgICAgICAgeWMgPSB5ICsgaFxuICAgICAgICBwb2x5X2RyYXdfbGluZSh4MSwgeWMsIHgyLCB5YywgYylcblxuICBpZiBuZWVkX2NsZWFuOlxuICAgIGRlZiBwb2x5X2NsZWFuX3NjcmVlbigpOlxuICAgICAgcG9seV9maWxsX3JlY3QoMCwgMCwgc2NyZWVuX3csIHNjcmVlbl9oLCBbMjU1LCAyNTUsIDI1NV0pXG5cbiAgcmV0dXJuIHNjcmVlbl93LCBzY3JlZW5faCwgcG9seV9oYXNfY29sb3IsIHBvbHlfc2V0X3BpeGVsLCBwb2x5X2RyYXdfbGluZSwgcG9seV9maWxsX3JlY3QsIHBvbHlfZmlsbF9lbGxpcHNlLCBwb2x5X2NsZWFuX3NjcmVlbiwgZm5vcFxuIn1dLCJXZWIiOlt7Im5hbWUiOiJwb2x5Y2FsMy5weSIsImNvbnRlbnQiOiIjY2FzXG5kZWYgY29sM18yX3JnYihjLCBiaXRzLCBiZ3IpOlxuICByZXR1cm4gY1syKmJncl0vLzIqKig4IC0gYml0c1swXSkgKyBjWzFdLy8yKiooOCAtIGJpdHNbMV0pKjIqKmJpdHNbMF0gKyBjWzIqKG5vdChiZ3IpKV0vLzIqKig4LWJpdHNbMl0pKjIqKihiaXRzWzBdICsgYml0c1sxXSlcblxuZGVmIGdldF9pbmZvcygpOlxuICBmbm9wID0gbGFtYmRhIDogTm9uZVxuICBzY3JlZW5fdywgc2NyZWVuX2gsIGNvbG9yX2JpdHMsIGZvbnRfdywgZm9udF9oLCBwb2x5X3Nob3cgPSAzMjAsIDIyMiwgWzUsIDYsIDVdLCAxMSwgMTgsIGZub3BcbiAgdHJ5OlxuICAgIGltcG9ydCBncmFwaGljLCBuc3BcbiAgICBkZWYgcG9seV9kcmF3X2xpbmUoeDEsIHkxLCB4MiwgeTIsIGMpOlxuICAgICAgZ3JhcGhpYy5kcmF3X2xpbmUoaW50KHgxKSwgaW50KHkxKSwgaW50KHgyKSwgaW50KHkyKSwgY29sM18yX3JnYihjLCBjb2xvcl9iaXRzLCAxKSlcbiAgICBkZWYgcG9seV9maWxsX3JlY3QoeDEsIHkxLCB4MiwgeTIsIGMpOlxuICAgICAgZ3JhcGhpYy5kcmF3X2ZpbGxlZF9yZWN0YW5nbGUoaW50KHgxKSwgaW50KHkxKSwgaW50KHgyKSwgaW50KHkyKSwgYylcbiAgICBkZWYgcG9seV9kcmF3X3N0cmluZyhzLCB4LCB5LCBjZiwgY2IpOlxuICAgICAgZ3JhcGhpYy5kcmF3X3N0cmluZyh4LCB5LCBzLCAobGlzdChjZikgPT0gWzI1NSwgMjU1LCAyNTVdKSBhbmQgY2Igb3IgY2YsIFwic21hbGxcIilcbiAgICBmb250X3csIGZvbnRfaCwgcG9seV9zaG93LCBwb2x5X3BhdXNlID0gMTIsIDE0LCBncmFwaGljLnNob3dfc2NyZWVuLCBuc3Aud2FpdEtleXByZXNzXG4gIGV4Y2VwdDpcbiAgICBpbXBvcnQga2FuZGluc2t5LCBpb25cbiAgICBwb2x5X2RyYXdfc3RyaW5nID0ga2FuZGluc2t5LmRyYXdfc3RyaW5nXG4gICAgZGVmIHBvbHlfZmlsbF9yZWN0KHgsIHksIHcsIGgsIGMpOlxuICAgICAga2FuZGluc2t5LmZpbGxfcmVjdChpbnQoeCksIGludCh5KSwgaW50KHcpLCBpbnQoaCksIGMpXG4gICAgZGVmIHBvbHlfcGF1c2UoKTpcbiAgICAgIGRlZiBrZXlfZG93bigpOlxuICAgICAgICBmb3IgayBpbiByYW5nZSg1Myk6XG4gICAgICAgICAgaWYgaW9uLmtleWRvd24oayk6XG4gICAgICAgICAgICByZXR1cm4gMVxuICAgICAgICByZXR1cm4gMFxuICAgICAgd2hpbGUga2V5X2Rvd24oKTpcbiAgICAgICAgcGFzc1xuICAgICAgd2hpbGUgbm90IChrZXlfZG93bigpKTpcbiAgICAgICAgcGFzc1xuICAgIGRlZiBwb2x5X2RyYXdfbGluZSh4MSwgeTEsIHgyLCB5MiwgYyk6XG4gICAgICBtLCBhMSwgYjEsIGEyLCBiMiA9IDAsIGludCh4MSksIGludCh5MSksIGludCh4MiksIGludCh5MilcbiAgICAgIGlmICh4MiAtIHgxKSAqKiAyIDwgKHkyIC0geTEpICoqIDI6XG4gICAgICAgIG0sIGExLCBhMiwgYjEsIGIyID0gMSwgYjEsIGIyLCBhMSwgYTJcbiAgICAgIGlmIG1pbihhMSwgYTIpICE9IGExOiBhMSwgYjEsIGEyLCBiMiA9IGEyLCBiMiwgYTEsIGIxXG4gICAgICBmb3IgayBpbiByYW5nZShhMiAtIGExICsgMSk6XG4gICAgICAgIGEsIGIgPSBhMSArIGssIGludChiMSArIChiMiAtIGIxKSAqIGsgLyAoKGEyIC0gYTEpIG9yIDEpKVxuICAgICAgICBrYW5kaW5za3kuc2V0X3BpeGVsKChhLCBiKVttXSwgKGIsIGEpW21dLCBjKVxuXG4gIHJldHVybiBzY3JlZW5fdywgc2NyZWVuX2gsIGZvbnRfdywgZm9udF9oLCBwb2x5X2RyYXdfbGluZSwgcG9seV9maWxsX3JlY3QsIHBvbHlfZHJhd19zdHJpbmcsIHBvbHlfc2hvdywgcG9seV9wYXVzZVxuIn0seyJuYW1lIjoid2ViLnB5IiwiY29udGVudCI6IiNjYXNcbmZyb20gcmFuZG9tIGltcG9ydCByYW5kb20sIHJhbmRpbnQsIGNob2ljZVxuZnJvbSBtYXRoIGltcG9ydCBwaSwgY29zLCBzaW4sIGZsb29yXG5mcm9tIHBvbHljYWwzIGltcG9ydCAqXG5cbnNjcmVlbl93LCBzY3JlZW5faCwgZm9udF93LCBmb250X2gsIHBvbHlfZHJhd19saW5lLCBwb2x5X2ZpbGxfcmVjdCwgcG9seV9kcmF3X3N0cmluZywgcG9seV9zaG93LCBwb2x5X3BhdXNlID0gZ2V0X2luZm9zKClcblxuIyBkZWYgY29sb3IyaW50KHIsIGcsIGIpOlxuIyAgcmV0dXJuIHIgfCAoZyAqIDI1NikgfCAoYiAqIDY1NTM2KVxuZGVmIGludDJjb2xvcih2KTpcbiAgcmV0dXJuIFt2ICYgMjU1LCAodiAvLyAyNTYpICYgMjU1LCAodiAvLyA2NTUzNikgJiAyNTVdXG5jb2xvcl9iYWNrID0gMFxuY29sb3JfZnJvbnQgPSAxNjc3NzIxNVxuc3ByaXRlcz0oXG4gIFsxNiwgMTYsIDE2OTYyODMxODE0NjUwNjcwMTcwMTUzODY3Njk3MDMyNzgxNzEwMTA3Njg1Nzc4ODY5NjMwMjI0MDc1NTEwMzY5NDI0MjIzNzc0MDgsIDMyNzY3LCAwXSxcbiAgWzE2LCAxNiwgOTA0MDY5MTM2MDUzMDQzMjQzMTYzMTE0NTA3NDk0NzA0NTQxMTk5MjAwNTQ2MjM2ODYyNzQwNjY5ODM2MDM2NjQ0NzIxMTExMDYwMTYsIDI1NSwgODM1NTcxMV0sXG4gIFsxNiwgNywgMTE0MjQ0OTA5NTgyNDQ3OTI0NTA2NzA5OTk4NzY0NzQ5NiwgNjU1MzUsIDY1MjgwXSxcbiAgWzE2LCA4LCAxNTk2MTE4MTg2OTYzMjQ0MDMyMjAyMjY4ODk2NjE0MjI2MzgyMCwgMTY3MTE2ODAsIDE2NzExOTM1XSxcbiAgWzExLCAxNiwgOTU3ODAyNDA1ODY4MzgxMjg3MTEwMDQyMjc4NTI5ODI3OTE0NDQzMDk5OTk5MzQ3MDg3OTIsIDE2MjU1LCAwXSxcbiAgWzUsIDE2LCA2ODAwOTk3NTA2MjY2MTYyMzAxODcwMTIsIDY1MjgwLCA4MzU1NzExXSxcbiAgWzksIDE2LCA1MTUzMzU4NTE0MjYzNzI4MTQxMDAyMTAyNTQ5NzYzODUwMjQwLCAxNjc3Njk2MCwgODM1NTcxMV1cbilcblxubXdzcHIsIG1oc3ByLCB6b29tLCBtd2MgPSAwLCAwLCAxLCAxXG5cbm1fcCwgbV9sLCBtX2ssIG1fYiwgbV9kLCBtX2EsIG1fbSA9IDEsIDQsIDE2LCA2NCwgMjU2LCAxMDI0LCA0MDk2XG5cbmRlZiB4eShzLCBuLCB3PTAsIGg9MCk6XG4gIGEgPSBzICogMiAqIHBpIC8gblxuICB4LCB5ID0gcm91bmQoeHdlYiArIHJ3ZWIqY29zKGEpKSwgcm91bmQoeXdlYiArIHJ3ZWIqc2luKGEpKVxuICB4ICs9IFtbbm90KG5vdCh3KSksIC13XVt4IDwgeHdlYl0sIC13Ly8yXVtzICogNCA9PSBuIG9yIHMgKiA0ID09IDMgKiBuXVxuICB5ICs9IFtbbm90KG5vdChoKSksIC1oXVt5IDwgeXdlYl0sIC1oIC8vIDJdW3MgPT0gMCBvciBzICogMiA9PSBuXVxuICByZXR1cm4geCwgeVxuXG5kZWYgZHJhd19zcHJpdGUoaV9zcHIsIHgsIHksIGlfYywgej0xKTpcbiAgc3ByID0gc3ByaXRlc1tpX3Nwcl1cbiAgdywgaCwgdiwgZHgsIGR5ID0gc3ByWzBdLCBzcHJbMV0sIHNwclsyXSwgMCwgMFxuICB3aGlsZSB2ID4gMDpcbiAgICBpZiB2ICYgMTpcbiAgICAgIHBvbHlfZmlsbF9yZWN0KGludCh4ICsgeipkeCksaW50KHkgKyB6KmR5KSwgeiwgeiwgaW50MmNvbG9yKHNwclszICsgaV9jXSkpXG4gICAgZHkgPSAoZHkgKyAxKSAlIGhcbiAgICB4ICs9IHogKiAobm90KGR5KSlcbiAgICB2ID0gdiAvLyAyXG5cbmRlZiBkcmF3X2Nvbm5lY3Rpb24oczEsIHMyLCBjKTpcbiAgeDEsIHkxID0geHkoczEsIGRpbXdlYikgIFxuICB4MiwgeTIgPSB4eShzMiwgZGltd2ViKSAgXG4gIHBvbHlfZHJhd19saW5lKHgxLCB5MSwgeDIsIHkyLCBpbnQyY29sb3IoYykpXG5cbmRlZiBkcmF3X2Nvbm5lY3Rpb25zKHMsIHMwLCBjKTpcbiAgZm9yIGkgaW4gcmFuZ2UoczAsIGRpbXdlYik6XG4gICAgaWYgd2ViW3NdW2ldOlxuICAgICAgZHJhd19jb25uZWN0aW9uKHMsIGksIGMpXG5cbmRlZiByZWZyZXNoX3BsYXRmb3JtKGkpOlxuICB4LCB5ID0geHkoaSwgZGltd2ViLCB3cGYsIGhwZilcbiAgcG9seV9maWxsX3JlY3QoeCwgeSwgd3BmLCBocGYsIGludDJjb2xvcihjb2xvcl9iYWNrKSlcbiAgcGZpID0gcGxhdGZvcm1zW2ldXG4gIGlmIHBmaTpcbiAgICBmb3IgayBpbiByYW5nZShsZW4oc3ByaXRlcykpOlxuICAgICAgaWYgcGZpICYgKDMgKiAyKiooMiAqIGspKTpcbiAgICAgICAgeCwgeSA9IHh5KGksIGRpbXdlYiwgc3ByaXRlc1trXVswXSwgc3ByaXRlc1trXVsxXSlcbiAgICAgICAgZHJhd19zcHJpdGUoaywgeCwgeSwgKHBmaSAvLyAyKiooMiprICsgMSkpICYgMSlcbiAgZWxzZTpcbiAgICB4LCB5ID0geHkoaSwgZGltd2ViLCBmb250X3csIGZvbnRfaClcbiAgICBwb2x5X2RyYXdfc3RyaW5nKFtjaHIoaSArIDU1KSwgc3RyKGkpXVtpIDw9IDldLCB4LCB5LCBpbnQyY29sb3IoY29sb3JfZnJvbnQpLCBpbnQyY29sb3IoY29sb3JfYmFjaykpXG5cbmRlZiBpbnNlcnRpbnRvKGwxLCBsMik6XG4gIGZvciB2IGluIGwxOlxuICAgIGlmIHYgbm90IGluIGwyOlxuICAgICAgbDIuYXBwZW5kKHYpXG4gIHJldHVybiBsMlxuXG5kZWYgcmVtb3ZlZnJvbShsMSwgbDIpOlxuICBmb3IgdiBpbiBsMTpcbiAgICB0cnk6XG4gICAgICBsMi5yZW1vdmUodilcbiAgICBleGNlcHQ6XG4gICAgICBwYXNzXG4gIHJldHVybiBsMlxuXG5kZWYgY29ubmVjdFBsYXRmb3JtcyhzMSwgczIpOlxuICBnbG9iYWwgd2ViXG4gIHdlYltzMV1bczJdLCB3ZWJbczJdW3MxXSA9IDEsIDFcblxuZGVmIGdldF9yZWFjaGFibGVfcGxhdGZvcm1zX2Zyb21fcGxhdGZvcm1zKGwsIHNhZmUpOlxuICBsdiA9IFtdXG4gIGZvciBzIGluIGw6XG4gICAgZm9yIGkgaW4gcmFuZ2UoZGltd2ViKTpcbiAgICAgIGlmIHdlYltzXVtpXTpcbiAgICAgICAgaWYgaSBub3QgaW4gbHYgYW5kIChub3Qoc2FmZSkgb3Igbm90IChwbGF0Zm9ybXNbaV0gJiBtX3ApKTpcbiAgICAgICAgICBsdi5hcHBlbmQoaSlcbiAgcmV0dXJuIGx2XG5cbmRlZiBjYW5nbyhzMSwgczIsIHNhZmUpOlxuICBsdm8xLCBsdmkxLCBsdm8yLCBsdmkyLCB0X2ludGVyLCBrID0gW10sIFtzMV0sIFtdLCBbczJdLCAwLCAwXG4gIHdoaWxlIG5vdCAodF9pbnRlcikgYW5kIGxlbihsdmkxKSBhbmQgbGVuKGx2aTIpOlxuICAgIGx2bzEsIGx2bzIgPSBpbnNlcnRpbnRvKGx2bzEsIGx2aTEpLCBpbnNlcnRpbnRvKGx2bzIsIGx2aTIpXG4gICAgZm9yIHYgaW4gbHZvMTpcbiAgICAgIGlmIHYgaW4gbHZvMjpcbiAgICAgICAgcmV0dXJuIGtcbiAgICBsdmkxLCBsdmkyID0gZ2V0X3JlYWNoYWJsZV9wbGF0Zm9ybXNfZnJvbV9wbGF0Zm9ybXMobHZvMSwgc2FmZSksIGdldF9yZWFjaGFibGVfcGxhdGZvcm1zX2Zyb21fcGxhdGZvcm1zKGx2bzIsIHNhZmUpXG4gICAgbHZpMSwgbHZpMiA9IHJlbW92ZWZyb20obHZvMSwgbHZpMSksIHJlbW92ZWZyb20obHZvMiwgbHZpMilcbiAgICBrICs9IDFcbiAgcmV0dXJuIDBcblxuZGVmIG15X2JpdG9yKGEsIGIpOlxuICByZXR1cm4gfih+YSAmIH5iKVxuXG5kZWYgaW5pdF93ZWIoZCwgcF9wLCBwX2IpOlxuICBnbG9iYWwgd2ViLCB4d2ViLCB5d2ViLCByd2ViLCBwbGF0Zm9ybXMsIG13c3ByLCBtaHNwciwgem9vbSwgbXdjLCBzcHJpdGVzLCBzY3JlZW5fdywgc2NyZWVuX2hcbiAgZm9yIGkgaW4gcmFuZ2UoMSwgbGVuKHNwcml0ZXMpKTpcbiAgICBtd3NwciwgbWhzcHIgPSBtYXgobXdzcHIsIHNwcml0ZXNbaV1bMF0pLCBtYXgobWhzcHIsIHNwcml0ZXNbaV1bMV0pXG4gIHl3ZWIsIGwwID0gc2NyZWVuX2ggLyAyLCBsaXN0KHJhbmdlKGRpbXdlYikpXG4gIHJ3ZWIgPSB5d2ViIC0gbWF4KG1oc3ByLCBmb250X2gpXG4gIGwwLnJlbW92ZSgwKVxuICB3ZWIsIHh3ZWIsIHBsYXRmb3JtcywgY29ubiwgZGNvbm4sIGlfayA9IFtdLCByd2ViICsgbWF4KG13c3ByLCBmb250X3cpLCBbMCBmb3IgayBpbiByYW5nZShkaW13ZWIpXSwgWzBdLCBsaXN0KHJhbmdlKDEsIGRpbXdlYikpLCBjaG9pY2UobDApXG4gIGZvciBqIGluIHJhbmdlKGRpbXdlYik6XG4gICAgd2ViLmFwcGVuZChbMCBmb3IgayBpbiByYW5nZShkaW13ZWIpXSlcbiAgd2hpbGUgbGVuKGRjb25uKTpcbiAgICBzID0gZGNvbm5bcmFuZGludCgwLCBsZW4oZGNvbm4pIC0gMSldXG4gICAgY29ubmVjdFBsYXRmb3Jtcyhjb25uW3JhbmRpbnQoMCwgbGVuKGNvbm4pIC0gMSldLCBzKVxuICAgIGRjb25uLnJlbW92ZShzKVxuICAgIGNvbm4uYXBwZW5kKHMpXG4gIGZvciBqIGluIHJhbmdlKGRpbXdlYi0xKTpcbiAgICBmb3IgaSBpbiByYW5nZShqICsgMSwgZGltd2ViKTpcbiAgICAgIGlmIGZsb29yKGQgKyByYW5kb20oKSk6XG4gICAgICAgIGNvbm5lY3RQbGF0Zm9ybXMoaSwgailcbiAgaV9kID0gY2hvaWNlKGwwKVxuICBwbGF0Zm9ybXNbaV9kXSA9IG15X2JpdG9yKHBsYXRmb3Jtc1tpX2RdLCBtX2QpXG4gIGwxID0gbGlzdChsMClcbiAgZm9yIHYgaW4gZ2V0X3JlYWNoYWJsZV9wbGF0Zm9ybXNfZnJvbV9wbGF0Zm9ybXMoWzBdLCAwKTpcbiAgICBsMS5yZW1vdmUodilcbiAgaWYgbm90KGxlbihsMSkpOlxuICAgIGwxID0gbDBcbiAgbDIgPSBsaXN0KGwxKVxuICBmb3IgdiBpbiBnZXRfcmVhY2hhYmxlX3BsYXRmb3Jtc19mcm9tX3BsYXRmb3JtcyhnZXRfcmVhY2hhYmxlX3BsYXRmb3Jtc19mcm9tX3BsYXRmb3JtcyhbMF0sIDApLCAwKTpcbiAgICB0cnk6XG4gICAgICBsMi5yZW1vdmUodilcbiAgICBleGNlcHQ6XG4gICAgICBwYXNzXG4gIGlmIG5vdChsZW4obDIpKTpcbiAgICBsMiA9IGwxXG4gIGlfbCA9IGNob2ljZShsMilcbiAgcGxhdGZvcm1zW2lfbF0gPSBteV9iaXRvcihwbGF0Zm9ybXNbaV9sXSwgbV9sKVxuICBwbGF0Zm9ybXNbaV9rXSA9IG15X2JpdG9yKHBsYXRmb3Jtc1tpX2tdLCBtX2spXG4gIGZvciBpIGluIGwxOlxuICAgIGlmIGkgIT0gaV9rIGFuZCBpICE9IGlfZCBhbmQgZmxvb3IocF9wKmRpbXdlYi9sZW4obDEpICsgcmFuZG9tKCkpOlxuICAgICAgcGxhdGZvcm1zW2ldID0gbXlfYml0b3IocGxhdGZvcm1zW2ldLCBtX3ApXG4gICAgICBpZiBub3QgY2FuZ28oMCwgaV9rLCAxKSBvciBub3QgY2FuZ28oMCwgaV9kLCAxKTpcbiAgICAgICAgcGxhdGZvcm1zW2ldID0gcGxhdGZvcm1zW2ldICYgfm1fcFxuXG4gICAgICAgIHBsYXRmb3Jtc1tpXSA9IG15X2JpdG9yKHBsYXRmb3Jtc1tpXSwgbV9wKVxuICAgIGlmIGZsb29yKHBfYipkaW13ZWIvbGVuKGwxKSArIHJhbmRvbSgpKTpcbiAgICAgIHBsYXRmb3Jtc1tpXSA9IG15X2JpdG9yKHBsYXRmb3Jtc1tpXSwgbV9iKVxuICBmb3IgayBpbiByYW5nZShsZW4oc3ByaXRlcyksIDAsIC0xKTpcbiAgICB0em9vbSA9IGludChtaW4oKChzY3JlZW5fdyAtIHNjcmVlbl9oKSAvIG13c3ByKSAvLyBrLCAoc2NyZWVuX2ggKiBrIC8gbWhzcHIpIC8vIGxlbihzcHJpdGVzKSkpXG4gICAgaWYgdHpvb20gPj0gem9vbTpcbiAgICAgIHpvb20sIG13YyA9IHR6b29tLCBrXG5cbmRlZiBwYXJjb3VyaXJfc2Vsb24oaWEpOlxuICBnbG9iYWwgZGltd2ViLCB3cGYsIGhwZiwgcGxhdGZvcm1zLCBzcHJpdGVzLCBzY3JlZW5fdywgc2NyZWVuX2hcbiAgdF9jb2VmZiA9IG1pbigxLCBzY3JlZW5faCAvIDI0MClcbiAgZGltd2ViID0gaW50KHRfY29lZmYgKiAzNilcbiAgbWF4Y291cHMgPSBkaW13ZWIqKjIgKiAyXG4gIGluaXRfd2ViKHRfY29lZmYgKiAuMDUsIC4xLCAuMTUpXG4gIHdwZiwgaHBmID0gbWF4KGZvbnRfdywgbXdzcHIpLCBtYXgoZm9udF9oLCBtaHNwcilcbiAgcG9seV9maWxsX3JlY3QoMCwgMCwgc2NyZWVuX3csIHNjcmVlbl9oLCBpbnQyY29sb3IoY29sb3JfYmFjaykpXG4gIGZvciBpIGluIHJhbmdlKGRpbXdlYik6XG4gICAgZHJhd19jb25uZWN0aW9ucyhpLCBpICsgMSwgY29sb3JfZnJvbnQpXG4gICAgcmVmcmVzaF9wbGF0Zm9ybShpKVxuICBzMCwgczEsIHMyLCBzMywgczQsIHM1LCBzNiwgczcgPSAwLCAwLCBtX2EsIDAsIDEsIC0xLCAwLCAwXG4gIHBmczAsIHBmczUgPSBwbGF0Zm9ybXNbczBdLCAwXG4gIHdoaWxlIHM0ID4gMCAgYW5kIChub3QgKHMyICYgKDIgKiBtX2spKSBvciBub3QgKHBmczAgJiBtX2QpKTpcbiAgICBpZiBzNSA8IDA6XG4gICAgICBzNSA9IDBcbiAgICBlbHNlOlxuICAgICAgdHJ5OlxuICAgICAgICBrLCBrMiA9IGlhKHMwLCB2b2lzaW5lcywgZGltd2ViLCBzMSwgczIpXG4gICAgICAgIGlmIHBmczUgJiAoMiAqIG1fYik6XG4gICAgICAgICAgd2hpbGUgczAgPT0gczU6XG4gICAgICAgICAgICBzMCA9IHJhbmRpbnQoMCwgZGltd2ViIC0gMSlcbiAgICAgICAgICBwZnMwLCBwZnM1ID0gbXlfYml0b3IocGxhdGZvcm1zW3MwXSwgbV9iKSwgcGZzNSAmIH4oMyAqIG1fYikgJiB+bV9tXG4gICAgICAgIGVsc2U6XG4gICAgICAgICAgaWYgazI6XG4gICAgICAgICAgICBpZiBzMiAmIG1fYTpcbiAgICAgICAgICAgICAgdiA9IHBsYXRmb3Jtc1trXVxuICAgICAgICAgICAgICBpZiB2ICYgbV9sOlxuICAgICAgICAgICAgICAgIHYsIHMyID0gdiAmIH5tX2wsIG15X2JpdG9yKHMyLCAyICogbV9sKVxuICAgICAgICAgICAgICAgIHBsYXRmb3Jtc1trXSA9IG15X2JpdG9yKHYsIDIgKiBtX2wpXG4gICAgICAgICAgICAgIHMyID0gczIgJiB+bV9hXG4gICAgICAgICAgICAgIHMyID0gbXlfYml0b3IoczIsIDIgKiBtX2EpXG4gICAgICAgICAgZWxzZTpcbiAgICAgICAgICAgIGlmIGsgaW4gdm9pc2luZXM6XG4gICAgICAgICAgICAgIHMwID0ga1xuICAgICAgICAgICAgICBpZiBwZnM1ICYgbV9iOlxuICAgICAgICAgICAgICAgIHBmczUgPSBteV9iaXRvcihwZnM1LCAyICogbV9iKVxuICAgICAgICAgICAgICBwZnMwLCBwZnM1ID0gcGxhdGZvcm1zW3MwXSwgcGZzNSAmIH5tX21cbiAgICAgICAgICBzMyArPSAxXG4gICAgICAgICAgaWYgczMgPj0gbWF4Y291cHM6XG4gICAgICAgICAgICBzNCA9IDBcbiAgICAgICAgaWYgcGZzMCAmIG1fazpcbiAgICAgICAgICBwZnMwID0gcGZzMCAmIH5tX2tcbiAgICAgICAgICBzMiA9IG15X2JpdG9yKHMyLCAyICogbV9rKVxuICAgICAgICBpZiBwZnMwICYgbXlfYml0b3IobV9wLCBtX2wpOlxuICAgICAgICAgIHM0ID0gMFxuICAgICAgICAgIHBmczAgPSBteV9iaXRvcihwZnMwLCAyICogbV9tKVxuICAgICAgICBwbGF0Zm9ybXNbczVdID0gcGZzNVxuICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyB0X2V4Y3B0OlxuICAgICAgICBzNCA9IC0xXG4gICAgICAgIHByaW50KHRfZXhjcHQpXG4gICAgcGZzMCA9IG15X2JpdG9yKHBmczAsIG1fbSlcbiAgICBzMSwgdm9pc2luZXMgPSBwZnMwLCBnZXRfcmVhY2hhYmxlX3BsYXRmb3Jtc19mcm9tX3BsYXRmb3JtcyhbczBdLCAwKVxuICAgIHBsYXRmb3Jtc1tzMF0gPSBwZnMwXG4gICAgZm9yIHYgaW4gdm9pc2luZXM6XG4gICAgICB0ID0gbXlfYml0b3IobV9wLCBtX2wpXG4gICAgICB0ID0gcGxhdGZvcm1zW3ZdICYgbXlfYml0b3IodCwgbV9rKVxuICAgICAgczEgPSBteV9iaXRvcihzMSwgdClcbiAgICBmb3IgdiBpbiBnZXRfcmVhY2hhYmxlX3BsYXRmb3Jtc19mcm9tX3BsYXRmb3Jtcyh2b2lzaW5lcywgMCk6XG4gICAgICB0ID0gcGxhdGZvcm1zW3ZdICYgbV9sXG4gICAgICBzMSA9IG15X2JpdG9yKHMxLCB0KVxuICAgIGRyYXdfY29ubmVjdGlvbnMoczUsIDAsIGNvbG9yX2Zyb250KVxuICAgIGRyYXdfY29ubmVjdGlvbnMoczAsIDAsIDE2Nzc2OTYwKVxuICAgIGlmIGNhbmdvKHMwLCBzNSwgMCkgPT0gMTpcbiAgICAgIGRyYXdfY29ubmVjdGlvbihzMCwgczUsIDY1MjgwKVxuICAgIHJlZnJlc2hfcGxhdGZvcm0oczUpXG4gICAgcmVmcmVzaF9wbGF0Zm9ybShzMClcbiAgICBzLCBzb2xkID0gbXlfYml0b3IoczEsIHMyKSwgbXlfYml0b3IoczYsIHM3KVxuICAgIGZvciBrIGluIHJhbmdlKGxlbihzcHJpdGVzKSAtIDEpOlxuICAgICAgaWYgcyAmIDMgIT0gc29sZCAmIDM6XG4gICAgICAgIHgsIHkgPSBzY3JlZW5fdyAtIDEgLSB6b29tKm13c3ByKigxICsgayVtd2MpICsgKHpvb20gKiAobXdzcHIgLSBzcHJpdGVzW2tdWzBdKSkvLzIsIChrIC8vIG13YykqbWhzcHIqem9vbSArIHpvb20qKG1oc3ByIC0gc3ByaXRlc1trXVsxXSkvLzJcbiAgICAgICAgaWYgcyAmIDM6XG4gICAgICAgICAgZHJhd19zcHJpdGUoaywgeCwgeSwgKHMgJiAzKSAvLyAyLCB6b29tKVxuICAgICAgICBlbHNlOlxuICAgICAgICAgIHBvbHlfZmlsbF9yZWN0KHgsIHksIHNwcml0ZXNba11bMF0gKiB6b29tLCBzcHJpdGVzW2tdWzFdICogem9vbSwgaW50MmNvbG9yKGNvbG9yX2JhY2spKVxuICAgICAgcywgc29sZCA9IHMgLy8gNCwgc29sZCAvLyA0XG4gICAgcG9seV9zaG93KClcbiAgICBwb2x5X3BhdXNlKClcbiAgICBzNSwgczYsIHM3LCBwZnM1ID0gczAsIHMxLCBzMiwgcGZzMFxuICB2LCByID0gMCwgczQgPiAwIGFuZCBzMyA8IG1heGNvdXBzXG4gIGlmIHI6XG4gICAgcHJpbnQoXCJHYWduZSAhIDotKVwiKVxuICBlbHNlOlxuICAgIHByaW50KFwiUGVyZHUgISA6LShcIilcbiAgICBpZiBwZnMwICYgbV9wOlxuICAgICAgcHJpbnQoXCJUb21iZSplIHB1aXRzXCIpXG4gICAgICB2ID0gMVxuICAgIGlmIHBmczAgJiBtX2w6XG4gICAgICBwcmludChcIk1hbmdlKmUgTGV2aWF0aGFuXCIpXG4gICAgICB2ID0gdiB8IDJcbiAgICBpZiBzMyA+PSBtYXhjb3VwczpcbiAgICAgIHByaW50KFwiRW5lcmdpZSBlcHVpc2VlXCIpXG4gICAgZWxpZiBzNCA8IDA6XG4gICAgICBwcmludChcIkV4Y2VwdGlvbiBpbnRlcm5lXCIpXG4gICAgICB2ID0gdiB8IDRcbiAgcyA9IFwiRW4gXCIgKyBzdHIoczMpICsgXCIgY291cFwiXG4gIGlmIHMzID4gMTpcbiAgICBzICs9IFwic1wiXG4gIHMgKz0gXCIuXCJcbiAgcHJpbnQocylcbiAgcmV0dXJuIHIsIHYsIHMyLCBzM1xuIn0seyJuYW1lIjoid2ViX3Rlc3QucHkiLCJjb250ZW50IjoiI2Nhc1xuZnJvbSB3ZWIgaW1wb3J0ICpcblxuZGVmIGlhKGNvcm5pY2hlLCB2b2lzaW5lcywgdGFpbGxlLCBjYXB0ZXVycywgZXZlbmVtZW50cyk6XG4gICMgTm91cyBzb21tZXMgZGFucyB1biBjcmF0ZXJlIGRlIHZvbGNhbi5cbiAgIyBJbCB5IGEgdW4gbm9tYnJlIHt0YWlsbGV9IGRlIGNvcm5pY2hlcy5cbiAgIyBMZXMgY29ybmljaGVzIHNvbnQgbnVtZXJvdGVlcyBkZSAwIGEge3RhaWxsZSAtIDF9LlxuXG4gICMgTm91cyBzb21tZXMgc3VyIGxhIGNvcm5pY2hlIG51bWVybyB7Y29ybmljaGV9LlxuICBpZiBjYXB0ZXVycyAmIG1fYjpcbiAgICAjIFVuZSBjaGF1dmUtc291cmlzIGRvcnQgc3VyIGNldHRlIGNvcm5pY2hlLiBFbGxlIHNlIHJldmVpbGxlcmEgZGVzIHF1ZSB0dVxuICAgICMgc2VyYXMgcGFydGkuZSBhdSBwcm9jaGFpbiB0b3VyICFcbiAgICBwYXNzXG4gIGlmIGNhcHRldXJzICYgbV9kOlxuICAgICMgQ2V0dGUgY29ybmljaGUgZG9ubmUgc3VyIGxhIHBvcnRlIGRlIHNvcnRpZS5cbiAgICBwYXNzXG4gIGlmIGNhcHRldXJzICYgbV9wOlxuICAgICMgVW5lIGRlcyBjb3JuaWNoZXMgdm9pc2luZXMgZGlzc2ltdWxlIHVuIHB1aXRzLiBQcm9ncmVzc2UgcHJ1ZGVtbWVudCAhXG4gICAgcGFzc1xuICBpZiBjYXB0ZXVycyAmIG1fazpcbiAgICAjIFVuZSBkZXMgY29ybmljaGVzIHZvaXNpbmVzIGVtZXQgZGUgbGEgbHVtaWVyZS4gTGEgY2xlIGRlIGxhIHNvcnRpZSBkb2l0XG4gICAgIyB5IGV0cmUgIVxuICAgIHBhc3NcbiAgaWYgY2FwdGV1cnMgJiBtX2w6XG4gICAgIyBMZSBMZXZpYXRoYW4gZ3JvbmRlLiBJbCBlc3QgYSAyIHBhcyBvdSBtb2lucyBkJ2ljaS4gUydpbCBuJ2VzdCBwYXMgZGFuc1xuICAgICMgdW5lIGRlcyBjb3JuaWNoZXMgdm9pc2luZXMsIGlsIGVzdCBzdXIgdW5lIHZvaXNpbmUgZCd1bmUgdm9pc2luZS4uLlxuICAgIHBhc3NcbiAgaWYgZXZlbmVtZW50cyAmICgyICogbV9rKTpcbiAgICAjIEJyYXZvLCB0dSBhcyB0cm91dmUgbGEgY2xlIGRlIGxhIHBvcnRlIGRlIHNvcnRpZSAhXG4gICAgcGFzc1xuICBpZiBldmVuZW1lbnRzICYgbV9hOlxuICAgICMgVHUgcGV1eCB0aXJlciB1bmUgZmxlY2hlIHZlcnMgdW5lIGRlcyBjb3JuaWNoZXMgdm9pc2luZXMuXG4gICAgcGFzc1xuICBpZiBldmVuZW1lbnRzICYgKDIgKiBtX2wpOlxuICAgICMgTGUgTGV2aWF0aGFuIGEgZXRlIHRvdWNoZSBtb3J0ZWxsZW1lbnQsIGlsIG5lIHBvc2UgcGx1cyBkZSBkYW5nZXIgIVxuICAgIHBhc3NcbiAgaWYgY2FwdGV1cnMgJiAoMiAqIG1fYik6XG4gICAgIyBVbmUgY2hhdXZlLXNvdXJpcyB0J2FzIGF0dHJhcGUuZSwgZXQgdCdlbW1lbmUgc3VyIHVuZSBhdXRyZSBjb3JuaWNoZVxuICAgICMgc2FucyB0ZSBkZW1hbmRlciB0b24gYXZpcy4gVHUgbmUgcGV1eCBwYXMgY2hvaXNpciB0YSBkZXN0aW5hdGlvbiAhXG4gICAgcGFzc1xuXG4gICMgcmVudm9pZSAyIHZhbGV1cnMgOlxuICAjICogbGEgY29ybmljaGUgY2hvaXNpZSBwYXJtaSBsZXMgdm9pc2luZXNcbiAgIyAqIGwnYWN0aW9uIHJlbGF0aXZlIGRlc2lyZWUgOlxuICAjICAgLSAwIHBvdXIgYWxsZXIgc3VyIGNldHRlIGNvcmNuaWNoZVxuICAjICAgLSAxIHBvdXIgdGlyZXIgdW5lIGZsZWNoZSB2ZXJzIGNldHRlIGNvcmNuaWNoZVxuICByZXR1cm4gdm9pc2luZXNbcmFuZGludCgwLCBsZW4odm9pc2luZXMpIC0gMSldLCAwXG5cbnBhcmNvdXJpcl9zZWxvbihpYSlcbiJ9XX0=")));

    constructor() {
        this.onAuthStateChangedHandler = [];
        this.user = null;
        this.gists = null;
        
        window.localStorage.setItem('projects', TiPlanetConnector.__init_projects);
    }

    /**
     * @returns {TiPlanetConnector}
     */
    static getInstance() {
        if (TiPlanetConnector.__instance == null) {
            TiPlanetConnector.__instance = new TiPlanetConnector();
        }

        return this.__instance;
    }

    getUserName() {
        return "Dummy Name";
    }

    getUserPhotoURL() {
        return profile;
    }

    onAuthStateChanged(changed_func) {
        this.onAuthStateChangedHandler.push(changed_func);
    }

    removeAuthStateChanged(changed_func) {
        this.onAuthStateChangedHandler = this.onAuthStateChangedHandler.filter(element => element !== changed_func);
    }

    isLogged() {
        return true;
    }

    login(function_good, function_error) {
        function_good();
    }

    logout() {
        
    }

    getDefaultFileName(name) {
        var init_file_name = "";
        
        for(let i in name.toLowerCase()) {
            let char = name.toLowerCase()[i];
            if (TiPlanetConnector.__allowed_chars_file.includes(char)) {
                init_file_name += char;
            }
        }
        
        if (init_file_name.length === 0) {
            init_file_name = "main";
        }
        
        init_file_name += ".py";
        
        return init_file_name;
    }
    
    getDefaultFiles(name) {
        let files = {};
        
        files[this.getDefaultFileName(name)] = {
            "content": TiPlanetConnector.__init_file_content
        };
        
        return files;
    }

    getProjects(callback) {
        var projects = window.localStorage.getItem('projects');

        if (projects === null) {
            projects = {};
            window.localStorage.setItem('projects', JSON.stringify(projects));
        } else {
            projects = JSON.parse(projects);
        }

        let output = [];
        for (let name in projects) {
            output.push({
                "name": name,
                "files": [],
                "loaded": false,
                "loading": false,
                "selected": false
            });
        }
        
        console.log(output);

        callback(output);
    }

    loadProject(name, callback) {
        var projects = window.localStorage.getItem('projects');

        if (projects === null) {
            projects = {};
            window.localStorage.setItem('projects', JSON.stringify(projects));
        } else {
            projects = JSON.parse(projects);
        }
        
        if (projects[name] === undefined) {
            callback(null);
            return;
        }
        
        callback({
            "name": name,
            "files": projects[name],
            "loaded": true,
            "loading": false,
            "selected": true
        });
    }

    createProject(name, callback) {
        var projects = window.localStorage.getItem('projects');

        if (projects === null) {
            projects = {};
            window.localStorage.setItem('projects', JSON.stringify(projects));
        } else {
            projects = JSON.parse(projects);
        }

        if (projects[name] !== undefined) {
            callback(null);
            return;
        }
        
        projects[name] = [{
            "name": this.getDefaultFileName(name),
            "content": TiPlanetConnector.__init_file_content
        }];

        callback({
            "name": name,
            "files": projects[name],
            "loading": false,
            "loaded": true,
            "selected": true
        });
        
        window.localStorage.setItem('projects', JSON.stringify(projects));
    }

    renameProject(oldname, newname, callback) {
        var projects = window.localStorage.getItem('projects');

        if (projects === null) {
            projects = {};
            window.localStorage.setItem('projects', JSON.stringify(projects));
        } else {
            projects = JSON.parse(projects);
        }

        if (projects[oldname] === undefined) {
            callback(null, null);
            return;
        }
        
        projects[newname] = projects[oldname];
        delete projects[oldname];
        window.localStorage.setItem('projects', JSON.stringify(projects));
        callback(oldname, newname);
    }

    removeProject(name, callback) {
        var projects = window.localStorage.getItem('projects');

        if (projects === null) {
            projects = {};
            window.localStorage.setItem('projects', JSON.stringify(projects));
        } else {
            projects = JSON.parse(projects);
        }

        if (projects[name] === undefined) {
            callback(null);
            return;
        }
        
        delete projects[name];
        window.localStorage.setItem('projects', JSON.stringify(projects));
        callback(name);
    }

    saveProject(project, callback) {
        var projects = window.localStorage.getItem('projects');

        if (projects === null) {
            projects = {};
            window.localStorage.setItem('projects', JSON.stringify(projects));
        } else {
            projects = JSON.parse(projects);
        }

        if (projects[project.name] === undefined) {
            callback(null);
            return;
        }
        
        projects[project.name] = project.files;
        window.localStorage.setItem('projects', JSON.stringify(projects));
        callback(project);
    }
}

